<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Milk Record</title>

  <style>
    body {
      font-family: Poppins, sans-serif;
      background: linear-gradient(135deg, #fff7e6, #ffe0bd);
      padding: 30px;
    }
    h2 { 
      color:#ff9800; 
      margin-bottom:20px; 
      font-size:2rem;
      text-align:center;
    }

    #detailsBox {
      background:white; 
      padding:20px; 
      border-radius:12px;
      border:2px solid #ff9800; 
      margin-bottom:25px;
      font-size:1.1rem;
      box-shadow:0 4px 10px rgba(0,0,0,0.08);
    }

    table {
      width:100%; 
      border-collapse:collapse;
      background:white; 
      border-radius:12px; 
      overflow:hidden;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      margin-bottom:20px;
    }

    th {
      padding:12px; 
      background:#ff9800; 
      color:white;
      font-size:1.1rem;
    }

    td {
      padding:12px; 
      border-bottom:1px solid #ffe0bd; 
      text-align:center; 
      font-size:1rem;
    }

    tr:hover {
      background:#fff5e6;
    }

    #summaryBox {
      padding:18px;
      background:white; 
      border-radius:12px;
      border-left:6px solid #ff9800;
      box-shadow:0 4px 10px rgba(0,0,0,0.08);
      margin-bottom:20px;
    }

    .line {
      font-size:1.3rem;
      margin-bottom:8px;
    }

    .highlight {
      color:#d35400;
      font-weight:600;
    }

    button {
      padding:12px 18px;
      background:#ff9800; 
      color:white; 
      border:none;
      border-radius:8px; 
      cursor:pointer; 
      font-size:1.1rem;
      width:100%;
    }
    button:hover { background:#e68900; }
  </style>
</head>

<body>

  <h2>Milk Liability Record</h2>

  <div id="detailsBox"></div>

  <table id="recordTable">
    <tr>
      <th>Date</th>
      <th>Litres</th>
      <th>Rate</th>
      <th>Total</th>
    </tr>
  </table>

  <div id="summaryBox">
    <div class="line"><strong>Total Liability:</strong> <span id="total" class="highlight">₹0</span></div>
    <div class="line"><strong>Remaining to Pay:</strong> <span id="remaining" class="highlight">₹0</span></div>
  </div>

  <button onclick="goBack()">Back</button>

<script>
  // GET CURRENT CONSUMER
  const user = JSON.parse(localStorage.getItem("currentConsumer"));

  // DISPLAY NAME/ID
  document.getElementById("detailsBox").innerHTML =
    `<strong>Name:</strong> ${user.name} <br> 
     <strong>ID:</strong> ${user.id}`;

  const table = document.getElementById("recordTable");

  // KEY USED IN record3.html
  const key = `records_${user.id}`;
  const records = JSON.parse(localStorage.getItem(key)) || [];

  let total = 0;

  records.forEach(r => {
    // FIX OLD RECORDS FORMAT
    const litre = r.litre || r.liter || 0;
    const rate = r.rate || r.price || 0;
    const amount = r.amount || r.total || (litre * rate);

    // SKIP BROKEN RECORDS
    if (!r.date || litre == 0 || rate == 0) return;

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${r.date}</td>
      <td>${litre}</td>
      <td>${rate}</td>
      <td>₹${amount}</td>
    `;
    table.appendChild(row);

    total += Number(amount);
  });

  document.getElementById("total").innerText = "₹" + total;
  document.getElementById("remaining").innerText = "₹" + total;

  function goBack() {
    window.location.href = "index.html";
  }
</script>

</body>
</html>
